<!DOCTYPE html>
<html>
<head>
    <title>MeMiX ReMiX</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>

<body>
    <h1>MeMiX ReMiX</h1>

    @*<audio controls>
            <source src="~/music/Keys.mp3" type="audio/mp3" />
        </audio>*@
    <p> <h5>HOW IT WORKS:</h5></p>
    <ol>
        <li>Make an audio clip selection for each instrument</li>
        @*<li>Press the 'Load' button for each instrument to get it ready to play</li>*@
        <li>Click 'Play your song' and you will hear your results</li>
        <li>Repeat steps 1 & 2 you much as you like</li>
        <li>Save it when you have created your masterpiece</li>
    </ol>
    <table>
        <tr>
            <td>
                <p>Bass</p>
            </td>
            <td>
                <select id="bass-select" onchange="javascript: fileFinder(0, 'bass-select');">
                    <option value="0">--</option>
                    <option value="1">Bass1</option>
                    <option value="2">Bass2</option>
                    <option value="3">Bass3</option>
                    <option value="4">Bass4</option>
                </select>
            </td>
            <td>
                @*<button id="load-bass" onclick="bassLoader()" type="button">Load Bass</button>*@
            </td>
        </tr>
        <tr>
            <td><p>Synth</p></td>
            <td>
                <select id="synth-select" onchange="javascript: fileFinder(1, 'synth-select');">
                    <option value="0">--</option>
                    <option value="1">Synth1</option>
                    <option value="2">Synth2</option>
                    <option value="3">Synth3</option>
                    <option value="4">Synth4</option>
                    <option value="5">Synth5</option>

                </select>
            </td>
            <td>
                @*<button id="load-keys" onclick="keysLoader()" type="button">Load Keyboards</button>*@
            </td>
        </tr>
        <tr>
            <td><p>Drums</p></td>
            <td>
                <select id="drums-select" onchange="javascript: fileFinder(2, 'drums-select');">
                    <option value="0">--</option>
                    <option value="1">Drums1</option>
                    <option value="2">Drums2</option>
                    <option value="3">Drums3</option>
                    <option value="4">Drums4</option>
                    <option value="5">Drums5</option>
                    <option value="6">Drums6</option>

                </select>
            </td>
        <tr>
            <td><p>Glitch</p></td>
            <td>
                <select id="glitch-select" onchange="javascript: fileFinder(3, 'glitch-select');">
                    <option value="0">--</option>
                    <option value="1">Glitch1</option>
                    <option value="2">Glitch2</option>
                    <option value="3">Glitch3</option>
                    <option value="4">Glitch4</option>
                    <option value="5">Glitch5</option>
                    <option value="6">Glitch6</option>
                </select>
            </td>
        </tr>
        <tr>
            <td><p>Lead</p></td>
            <td>
                <select id="lead-select">
                    <option value="--">--</option>
                </select>
            </td>
            <td>
                @*<button id="load-drums" onclick="drumLoader()" type="button">Load Drums</button>*@
            </td>
        </tr>
        <tr>
            <td>
                <button type="button" id="play-song" data-playing="false" aria-checked="false">Play Your Song</button>
            </td>
            <td>
                <button id="stop-song" onlick="stopSong()" data-playing="true" aria-checked="true" type="button" disabled>Make it Stop!!!</button>
            </td>
        </tr>
    </table>

    <p><h4>Like what you've made? Give it a title and save it for later!</h4></p>

    <input value="feature coming soon" type="text" />
    <button type="submit">Save it!!!</button>


    <script type="text/javascript">

        var audioCtx = new AudioContext();
        var synth;
        var drums;
        var bass;
        var glitch;

        var bassURL = "/music/bass/bass";
        var synthURL = "/music/synth/synth";
        var drumURL = "/music/drums/drums";
        var glitchURL = "/music/glitch/glitch";

        var inst = [bassURL, synthURL, drumURL, glitchURL];

        function fileFinder(instrumentNumber, elementID) {
            var e = document.getElementById(elementID);
            pickNumber = e.options[e.selectedIndex].value;

            var fileURL = inst[instrumentNumber] + pickNumber + ".mp3";

            caseNumber = instrumentNumber + 1;
            
                var getAudio = new XMLHttpRequest();
                getAudio.open("GET", fileURL, true);
                getAudio.responseType = "arraybuffer";
                getAudio.onload = function () {
                    audioCtx.decodeAudioData(getAudio.response, function (buffer) {
                        switch (caseNumber) {
                            case 1:
                                bass = buffer;
                                break;
                            case 2:
                                synth = buffer;
                                break;
                            case 3:
                                drums = buffer;
                                break;
                            case 4:
                                glitch = buffer;
                        }
                    });
                    };            
                getAudio.send();
            
        };


        var playButton = document.getElementById("play-song")
        //count = 0;

        playButton.addEventListener('click', function () {

            // Eliminates 2 instances of song playing at same time upon multiple 'play' clicks
            //playButton.onclick = function () {
            //    count += 1;
            //}
            //if (count < 1) {

                // Plays tracks
                var playTrack = audioCtx.createBufferSource();
                playTrack.buffer = bass;
                playTrack.connect(audioCtx.destination);
                playTrack.start(0);

                var playTrack2 = audioCtx.createBufferSource();
                playTrack2.buffer = synth;
                playTrack2.connect(audioCtx.destination);
                playTrack2.start(0);

                var playTrack3 = audioCtx.createBufferSource();
                playTrack3.buffer = drums;
                playTrack3.connect(audioCtx.destination);
                playTrack3.start(0);

                var playTrack4 = audioCtx.createBufferSource();
                playTrack4.buffer = glitch;
                playTrack4.connect(audioCtx.destination);
                playTrack4.start(0);

                playButton.disabled = true;
            //}

            // Stop playback & reset 'Play' button counter to 0 to allow song to be started over
            var stopButton = document.getElementById("stop-song");
            stopButton.disabled = false;

            stopButton.addEventListener('click', function () {
                playTrack.stop();
                playTrack2.stop();
                playTrack3.stop();
                playTrack4.stop();

                playButton.disabled = false;
                stopButton.disabled = true;

                //count = 0;

            });

        });

    </script>

</body>
</html>